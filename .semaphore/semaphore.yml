version: "v1.0"
name: Example ppls
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Fetch deps
    task:
      jobs:
      - name: Download and cache
        commands:
          - cache list          
          - cache has_key elasticsearch-6.2.1 || wget -nc https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.1.deb
          - cache has_key elasticsearch-6.2.1 || cache store elasticsearch-6.2.1 elasticsearch-6.2.1.deb


  - name: Tests
    task:
      jobs:
      - name: language versions
        commands:
          - cache restore elasticsearch-6.2.1
          - echo "install ES and run tests"

promotions:
  - name: Deploy to Production
    pipeline_file: deploy.yml

    # Current state
    auto_promote_on:
      - branch:
          - ^master$
          - hotfix


    auto_promote_on:
      labels:
        - master
        - production
        - namoramominista  # label type: nesto_novos
      label_pattern: 
        - ^refs/tags/v1.1.*$
        - master
        - hotfix-.*
      result: failed
      result_reason: malformed
=======================================================
    auto_promote_on:
      - labels:
          branches:
            - master
            - /master/
            - production
            - /hotfix-.*/
          tags: 
            - /v1.1.*/
          nesto_novos: 
            - namoramominista       
        result: failed
        result_reason: malformed
======================================================
    auto_promote_on:
      - branches:
          - master
          - /master/
          - production
          - /hotfix-.*/
        tags: 
          - /v1.1.*/
        nesto_novos: 
          - namoramominista
        result: failed
        result_reason: malformed












    # A
    # 80%    
    # 99%
    # 100%
    auto_promote_on:
      - branches:
        - master
        - /master/
        - production
        - /hotfix-.*/
      tags: 
        - /v1.1.*/
      snapshot_label:
        - darko-devbox
      boja_auto:
        - plava
        
    # B
    auto_promote_on:
      labels:
         branch: master
        - production
      label_patterns:
        - hotfix-.*
        - "tag=v1.1.*"

df:
  - ^refs/tags/v.*$
  - 

    parameters: 
      env_vars:
        # Simplest example - everything is required
        - name: SERVER_IP
        - name: SERVER_HOSTNAME
        - name: SERVER_COLOR
        
        - name: TARGER
          description: Lorem impsum
          dafault_value: "C"
          options: 
            - "A"
            - "B"
            - "C" 

        # Simplest example
        - name: SERVER_IP
          description: Bla bla
        - name: SERVER_HOSTNAME
          description: Bla bla
        - name: SERVER_COLOR
          description: Bla bla

        # The value passed must be one from the list. In UI we merge default with values and select defaut. 
        # In API if some value which is different from default + values is sent we reject
        # In API if nothing is sent we set default value
        # In API if valid value is sent it will be that value :)      
        - name: SERVER_IP
          description: Lorem impsum
          dafault_value: "Bnbnbn"
          options: 
            - "A"
            - "B"
            - "C"          

        # The value passed must be one from the list. First is default in UI is black option in select box.
        # We are not sending anything to API if user selected blank value from the UI.
        - name: SERVER_IP
          required: false
          description: Lorem impsum      
          options: 
            - "192.158.23.23"
            - "192.158.23.23"

        # Just example of simplest form
        - name: SERVER_IP
          options: 
            - "192.158.23.23"
            - "192.158.23.23"      
