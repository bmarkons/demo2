version: "v1.0"
name: First pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1404

blocks:
  - name: "Build ppl"
    task:
      env_vars:
        - name: APP_ENV
          value: prod
      jobs:
      - name: language versions
        commands:
          - ls -lah
          - df -h
          - env
          - ruby -v
          - sem-version ruby 2.3
          - ruby -v
          - sem-version ruby 2.5
          - ruby -v
          - dockerize
          
      - name: services
        commands:
          - sudo systemctl start mysql
          - sudo systemctl start postgresql
          - sudo systemctl start mongod
          - sudo systemctl start redis-server
          - ps -eo command,user,pid,%mem --sort=%mem
      - name: docker services
        commands:
          - sem-service start postgres:9.6
          - sem-service start redis
          - sem-service start mysql
          - sem-service start memcached
          - ps -eo command,user,pid,%mem --sort=%mem
          
    
